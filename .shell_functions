# Utility shell functions.
# vi: ft=sh

# Source file if it exists.
sourceifexists() {
	[ -f "$1" ] && [ -r "$1" ] && . "$1"
}
export sourceifexists >/dev/null

cdw() {
	local prog="$1"
	type "$prog" &>/dev/null
	if [ "$?" -ne 0 ]; then
		echo "\"${prog}\" not found in \$PATH." >&2
	else
		dir=$(dirname $(which "$prog"))
		echo "$dir"
		cd "$dir"
	fi
}
export cdw >/dev/null
[ -n "$completion_func" ] && $completion_func -cf cdw

# Time conversions.
epoch2iso8601() {
    local epoch="$1"
    date -d @$epoch +%Y-%m-%dT%H:%M:%S%z
}
export epoch2iso8601 >/dev/null

iso86012epoch() {
    local iso="$1"
    date -d "$iso" +%s
}
export iso86012epoch >/dev/null

# Shell detect functions {
	export SHELL_PLATFORM='unknown'
	ostype() { echo $OSTYPE | tr '[A-Z]' '[a-z]'; }
	case "$(ostype)" in
		*'linux'*	) SHELL_PLATFORM='linux'	;;
		*'darwin'*	) SHELL_PLATFORM='osx'		;;
		*'bsd'*		) SHELL_PLATFORM='bsd'		;;
	esac

	shell_is_linux() { [ "$SHELL_PLATFORM" = 'linux' ]; }
	shell_is_osx()   { [ "$SHELL_PLATFORM" = 'osx' ]; }
	shell_is_bsd()   { [ "$SHELL_PLATFORM" = 'bsd' ] || [ "$SHELL_PLATFORM" = 'osx' ]; }
# }

# Git overlay which adds a command to cd to git root.
git() {
	local gitbin=/usr/bin/git
	if [ "$1"  = root ]; then
		local root="$($gitbin rev-parse --show-cdup)"
		[ -n "$root" ] && cd "$root"
	else
		$gitbin $*
	fi
}
